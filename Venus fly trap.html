<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Celliverse — Venus Flytrap Cell</title>
<style>
  :root{ --bg:#07120a; --panel:#05120b; --leaf:#bfffcf; --accent:#b9ff8a; }
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto;background:linear-gradient(180deg,#031415,#02100a 80%); color:#eef;}
  .wrap{max-width:1100px;margin:18px auto;padding:18px;}
  header{display:flex;gap:14px;align-items:center}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#baffd4,#d3ffb9);display:flex;align-items:center;justify-content:center;color:#033;font-weight:800}
  h1{margin:0}
  .row{display:flex;gap:18px;flex-wrap:wrap}
  .panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px}
  .left{flex:1 1 360px} .right{flex:1 1 620px}
  input[type=text]{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.02); color:#eef}
  .org-list{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
  .org-btn{padding:8px 10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); cursor:pointer;border:1px solid rgba(255,255,255,0.03); color:#dff}
  canvas{display:block;margin:12px auto;background:transparent}
  .meter{height:18px;background:rgba(255,255,255,0.04);border-radius:10px;overflow:hidden}
  .meter-fill{height:100%;width:0%;background:linear-gradient(90deg,#c6ffb3,#7ef78a);transition:width 600ms ease}
  .game-area{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.01)}
  .hint{font-size:13px;color:#cfe}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">VF</div>
      <div>
        <h1>Celliverse — Venus Flytrap Cell</h1>
        <div class="small">Plant cell adaptation mini-games — optimize photosynthesis and trapping strategies.</div>
      </div>
    </header>

    <div class="row">
      <div class="panel left">
        <label>Explorer Codename</label>
        <input id="player" placeholder="Type your codename">
        <div style="margin-top:10px">
          <div style="display:flex;justify-content:space-between">
            <div>Adaptation Progress</div>
            <div id="meter-percent">0%</div>
          </div>
          <div class="meter" style="margin-top:8px"><div id="meter-fill" class="meter-fill"></div></div>
        </div>
        <div class="hint" style="margin-top:8px">Complete the organelle mini-games to increase trap efficiency, photosynthesis, and nutrient capture.</div>
        <div class="org-list" id="org-list"></div>
        <div style="margin-top:8px">
          <button onclick="resetAll()">Reset</button> <a href="index.html">Back to Hub</a>
        </div>
      </div>

      <div class="panel right">
        <div id="current-org" style="font-weight:700">Select an organelle</div>
        <div class="game-area">
          <div id="org-desc">Organelles each have a real mini-game. Complete then click Apply Adaptation.</div>
          <canvas id="game-canvas" width="620" height="240"></canvas>
          <div style="margin-top:8px">
            <button id="open-btn" onclick="openOrg()" disabled>Open Game</button>
            <button id="apply-btn" onclick="applyAdapt()" disabled>Apply Adaptation</button>
            <div id="feedback" class="hint"></div>
          </div>
        </div>

        <div id="cell-visual" style="margin-top:12px;height:180px;border-radius:12px;background:radial-gradient(circle at 30% 20%, rgba(200,255,200,0.06), rgba(6,12,6,0.6));padding:10px"></div>
        <pre id="log" style="background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;margin-top:10px;color:#dff;white-space:pre-wrap"></pre>
      </div>
    </div>
  </div>

<script>
/* Plant cell organelles */
const organelles = [
  {id:'nucleus', title:'Nucleus', boost:11, desc:'Tune gene switches to optimize trap response.'},
  {id:'chlor', title:'Chloroplast', boost:15, desc:'Align chlorophyll panels to catch sunlight efficiently.'},
  {id:'rib', title:'Ribosome', boost:9, desc:'Assemble trap-trigger proteins quickly.'},
  {id:'er', title:'Endoplasmic Reticulum', boost:8, desc:'Route digestive enzymes to the trap.'},
  {id:'golgi', title:'Golgi', boost:8, desc:'Package enzymes into rapid-release vesicles.'},
  {id:'vacuole', title:'Vacuole', boost:12, desc:'Store captured nutrients for months.'},
  {id:'membrane', title:'Membrane', boost:8, desc:'Adjust ion channels to trigger trap movement.'},
  {id:'cellwall', title:'Cell Wall', boost:9, desc:'Strengthen trap edges to hold prey.'},
  {id:'perox', title:'Peroxisome', boost:6, desc:'Detoxify reactive oxygen during digestion.'},
  {id:'cyto', title:'Cytoskeleton', boost:10, desc:'Rapidly contract/relax to close the trap.'}
];

let playerName=''; let adaptation=0; const adaptTarget=100; let current=null; let gameState={};

const orgList = document.getElementById('org-list'); const canvas = document.getElementById('game-canvas'); const ctx = canvas.getContext('2d');
const meter = document.getElementById('meter-fill'); const percent = document.getElementById('meter-percent'); const log = document.getElementById('log');

function buildList(){ orgList.innerHTML=''; organelles.forEach((o,i)=>{ const b=document.createElement('button'); b.innerText=o.title; b.className='org-btn'; b.onclick=()=>selectOrg(i); if(o.done) b.style.filter='drop-shadow(0 6px 20px rgba(120,240,180,0.06))'; orgList.appendChild(b); }); }
buildList();

function selectOrg(i){ current = organelles[i]; document.getElementById('current-org').innerText = current.title; document.getElementById('org-desc').innerText = current.desc; document.getElementById('open-btn').disabled=false; document.getElementById('apply-btn').disabled=true; document.getElementById('feedback').innerText='Open the game to play.'; playerName = document.getElementById('player').value.trim(); }

function openOrg(){
  if(!current) return;
  document.getElementById('feedback').innerText='Playing: '+current.title;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // dispatch by id
  switch(current.id){
    case 'chlor': gameChlor(); break;
    case 'vacuole': gameVacuole(); break;
    case 'cyto': gameCytoskel(); break;
    case 'nucleus': gameDNA(); break;
    case 'rib': gameRibo(); break;
    case 'er': gameER(); break;
    case 'golgi': gameGolgi(); break;
    case 'membrane': gameMembrane(); break;
    case 'cellwall': gameWall(); break;
    case 'perox': gamePerox(); break;
    default: ctx.fillText('Game soon',10,20);
  }
}

/* ---- Example: Chloroplast (align panels) ---- */
function gameChlor(){
  // sliding panels to align with moving sun beams. Player clicks to lock position when beam crosses.
  gameState.chlor = { panels: [80, 200, 320], locked: [false,false,false], score:0, beams:[] };
  // beams move down; player must click a panel when a beam crosses that panel's x coordinate
  for(let i=0;i<6;i++){ gameState.chlor.beams.push({x:20 + Math.random()*560, y:-Math.random()*200, speed:1+Math.random()*1.2}); }
  function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#dfd'; ctx.fillText('Click lock on a panel when sunlight beam passes to catch energy (5 captures).',10,18);
    // draw panels
    for(let i=0;i<3;i++){
      ctx.fillStyle = gameState.chlor.locked[i]? '#c2ffb3' : '#356';
      ctx.fillRect(gameState.chlor.panels[i]-30,190,60,30);
      ctx.fillStyle='#012'; ctx.fillText('Panel'+(i+1), gameState.chlor.panels[i]-18, 210);
    }
    // move beams
    for(const b of gameState.chlor.beams){
      b.y += b.speed;
      ctx.fillStyle='#ffd'; ctx.fillRect(b.x, b.y, 6, 12);
      if(b.y>230) b.y = -40;
    }
    anim = requestAnimationFrame(loop);
  }
  let anim = requestAnimationFrame(loop);
  canvas.onclick = (e) => {
    // find nearest panel to click
    for(let i=0;i<3;i++){
      const px = gameState.chlor.panels[i];
      // if any beam within small vertical window and near x
      for(const bm of gameState.chlor.beams){
        if(Math.abs(bm.x - px) < 30 && bm.y > 160 && bm.y < 230 && !gameState.chlor.locked[i]){
          gameState.chlor.locked[i]=true; gameState.chlor.score++;
          if(gameState.chlor.score >= 5){ cancelAnimationFrame(anim); enablePlantAdapt(); }
        }
      }
    }
  };
}

/* ---- Vacuole: catch nutrient insects (simulate prey pieces) ---- */
function gameVacuole(){
  gameState.vac = { bucketX:260, prey:[], score:0 };
  for(let i=0;i<6;i++) gameState.vac.prey.push({x:Math.random()*600, y:-Math.random()*300, speed:1+Math.random()*1.5});
  function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#cfe'; ctx.fillText('Move bucket with mouse to catch small prey (5 catches).',10,18);
    for(const p of gameState.vac.prey){
      p.y += p.speed; ctx.fillStyle='#ffd9c2'; ctx.fillRect(p.x, p.y, 10, 12);
      if(p.y>200 && p.x > gameState.vac.bucketX && p.x < gameState.vac.bucketX+80){ p.y=-40; gameState.vac.score++; if(gameState.vac.score>=5){ cancelAnimationFrame(anim); enablePlantAdapt(); } }
    }
    ctx.fillStyle='#6a3'; ctx.fillRect(gameState.vac.bucketX,220,80,14);
    anim = requestAnimationFrame(loop);
  }
  let anim = requestAnimationFrame(loop);
  canvas.onmousemove = (e)=>{ gameState.vac.bucketX = Math.max(0, Math.min(540, e.offsetX-40)); };
}

/* ---- Cytoskeleton: rapid trap clamp (timing) ---- */
function gameCytoskel(){
  gameState.cyt = { timer:0, goal:Math.floor(50+Math.random()*90), hit:false };
  function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#cfe'; ctx.fillText('Click to clamp the trap when the moving meter is in the green zone (hit 1 time).',10,18);
    // meter bar moving
    const t = gameState.cyt.timer%200;
    const x = 40 + (t/200)*520;
    ctx.fillStyle='#333'; ctx.fillRect(40,120,520,30);
    // green zone
    ctx.fillStyle='#6f9'; ctx.fillRect(260,120,60,30);
    // indicator
    ctx.fillStyle='#ffd'; ctx.fillRect(x-6,116,12,38);
    gameState.cyt.timer+=4;
    if(!gameState.cyt.hit) anim = requestAnimationFrame(loop);
    else { enablePlantAdapt(); }
  }
  let anim = requestAnimationFrame(loop);
  canvas.onclick = (e)=>{ const t = gameState.cyt.timer%200; const x = 40 + (t/200)*520; if(x>260 && x<320){ gameState.cyt.hit=true; } };
}

/* ---- Nucleus: quick DNA puzzle (mini) */
function gameDNA(){
  // reuse simple matching but smaller
  let seq = ['AT','CG','AT','CG']; shuffle(seq);
  let open=[];
  draw();
  canvas.onclick=(e)=>{
    const idx = Math.floor(e.offsetX/150);
    if(open.includes(idx)) return;
    open.push(idx);
    if(open.length===2){
      if(seq[open[0]]===seq[open[1]]){ open=[]; done=true; enablePlantAdapt(); }
      else setTimeout(()=>{ open=[]; draw(); },400);
    }
    draw();
  };
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#cfe'; ctx.fillText('Match DNA mini-pairs to tune gene expression',10,18);
    for(let i=0;i<3;i++){
      ctx.fillStyle='#023'; ctx.fillRect(10+i*150,60,130,80);
      if(open.includes(i)) ctx.fillStyle='#fff', ctx.fillText(seq[i], 10+i*150+50, 110);
    }
  }
}

/* ---- Ribosome, ER, Golgi, Membrane, CellWall, Perox (quick workable games) ---- */
function gameRibo(){
  // sequence click speed: click 5 times rapidly
  gameState.rib = { clicks:0, start:Date.now() };
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#cfe'; ctx.fillText('Click the big button 10 times quickly to synthesize proteins',10,18);
  ctx.fillStyle='#6b3'; ctx.fillRect(200,60,200,100);
  ctx.fillStyle='#012'; ctx.fillText('CLICK', 290,120);
  canvas.onclick = (e)=>{ const x=e.offsetX, y=e.offsetY; if(x>200 && x<400 && y>60 && y<160){ gameState.rib.clicks++; if(gameState.rib.clicks>=10) enablePlantAdapt(); } };
}
function gameER(){
  // tile routing: click correct exit among 3 shown rapidly
  gameState.er = { rounds:0 };
  function drawRound(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const target = ['left','middle','right'][Math.floor(Math.random()*3)];
    ctx.fillStyle='#cfe'; ctx.fillText('Click the correct exit indicated by the glowing marker',10,18);
    // draw three exits
    ctx.fillStyle='#112'; ctx.fillRect(80,120,120,70); ctx.fillRect(260,120,120,70); ctx.fillRect(440,120,120,70);
    if(target==='left') ctx.fillStyle='#6f9', ctx.fillRect(80,120,120,70);
    if(target==='middle') ctx.fillStyle='#6f9', ctx.fillRect(260,120,120,70);
    if(target==='right') ctx.fillStyle='#6f9', ctx.fillRect(440,120,120,70);
    canvas.onclick = (e)=>{ gameState.er.rounds++; const x=e.offsetX; if((x>80&&x<200 && target==='left') || (x>260&&x<380&&target==='middle') || (x>440&&x<560&&target==='right')){ if(gameState.er.rounds>=5) enablePlantAdapt(); else drawRound(); } else { gameState.er.rounds=0; drawRound(); } };
  }
  drawRound();
}
function gameGolgi(){
  // simple click-collect: click glowing packages
  gameState.golgi = { need:8, collected:0, items:[] };
  for(let i=0;i<10;i++) gameState.golgi.items.push({x:20+Math.random()*580, y:20+Math.random()*120});
  function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#cfe'; ctx.fillText('Click on packages to collect and sort (collect 8).',10,18);
    for(const it of gameState.golgi.items){ ctx.fillStyle='#ffd9c2'; ctx.fillRect(it.x,it.y,18,12); }
  }
  draw();
  canvas.onclick=(e)=>{ for(let i=gameState.golgi.items.length-1;i>=0;i--){ const it=gameState.golgi.items[i]; if(e.offsetX>it.x && e.offsetX<it.x+18 && e.offsetY>it.y && e.offsetY<it.y+12){ gameState.golgi.items.splice(i,1); gameState.golgi.collected++; if(gameState.golgi.collected>=8) enablePlantAdapt(); draw(); } } };
}
function gameMembrane(){ gameState.m = { blocked:0, tox:[] }; for(let i=0;i<8;i++) gameState.m.tox.push({x:Math.random()*600, y:-Math.random()*200, vy:1+Math.random()}); function loop(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#cfe'; ctx.fillText('Move shield with mouse to block toxins (block 6).',10,18); for(const t of gameState.m.tox){ t.y += t.vy; ctx.beginPath(); ctx.fillStyle='rgba(255,80,80,0.9)'; ctx.arc(t.x,t.y,6,0,Math.PI*2); ctx.fill(); if(t.y>200){ t.y=-40; } } ctx.fillStyle='rgba(200,255,190,0.15)'; ctx.fillRect(mouseX-40,200,80,18); anim = requestAnimationFrame(loop);} let anim = requestAnimationFrame(loop); let mouseX=300; canvas.onmousemove = (e)=>{ mouseX=e.offsetX; }; canvas.onclick = (e)=>{ for(const t of gameState.m.tox){ if(Math.abs(t.x - mouseX) < 40 && t.y>190 && t.y<220){ gameState.m.blocked++; t.y=-40; if(gameState.m.blocked>=6){ cancelAnimationFrame(anim); enablePlantAdapt(); } } } } }
function gameWall(){ gameState.wall = { cracks:[] }; for(let i=0;i<6;i++) gameState.wall.cracks.push({x:40+i*90, y:100}); drawWall(); canvas.onclick=(e)=>{ // reinforce near click
  for(const c of gameState.wall.cracks){ if(Math.abs(e.offsetX - c.x) < 40){ c.reinforced = true; } }
  if(gameState.wall.cracks.filter(x=>x.reinforced).length>=5) enablePlantAdapt();
}; function drawWall(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#cfe'; ctx.fillText('Click near cracks to reinforce the wall (reinforce 5).',10,18); for(const c of gameState.wall.cracks){ ctx.fillStyle=c.reinforced? '#c6ffb3' : '#7bb'; ctx.fillRect(c.x-30, c.y, 60, 26); } } }
function gamePerox(){ gameState.per = { harmful:[], removed:0 }; for(let i=0;i<8;i++) gameState.per.harmful.push({x:20 + Math.random()*580, y:20 + Math.random()*120}); function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#cfe'; ctx.fillText('Click harmful particles to remove them (8).',10,18); for(const h of gameState.per.harmful){ ctx.fillStyle='rgba(255,100,100,0.9)'; ctx.beginPath(); ctx.arc(h.x,h.y,8,0,Math.PI*2); ctx.fill(); } } draw(); canvas.onclick=(e)=>{ for(let i=gameState.per.harmful.length-1;i>=0;i--){ const h=gameState.per.harmful[i]; if(Math.hypot(e.offsetX-h.x,e.offsetY-h.y)<10){ gameState.per.harmful.splice(i,1); gameState.per.removed++; if(gameState.per.removed>=8) enablePlantAdapt(); draw(); } } } }
function gameRibo(){ /* quick clicking button */ gameState.rib = { clicks:0 }; ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#cfe'; ctx.fillText('Click the protein button 10 times fast.',10,18); ctx.fillStyle='#6f8'; ctx.fillRect(260,80,100,80); ctx.fillStyle='#012'; ctx.fillText('PROTEIN',280,130); canvas.onclick=(e)=>{ if(e.offsetX>260&&e.offsetX<360&&e.offsetY>80&&e.offsetY<160){ gameState.rib.clicks++; if(gameState.rib.clicks>=10) enablePlantAdapt(); } } }
function gameER(){ /* quick packet sort */ gameState.er = { passes:0 }; ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#cfe'; ctx.fillText('Click the correct passing packet 6 times.',10,18); canvas.onclick = (e)=>{ gameState.er.passes++; if(gameState.er.passes>=6) enablePlantAdapt(); } }

/* ---- adaptation application ---- */
function enablePlantAdapt(){
  document.getElementById('apply-btn').disabled = false;
  document.getElementById('feedback').innerText = 'Game complete. Apply Adaptation to increase trap efficiency.';
}
function applyAdapt(){ if(!current) return; current.done = true; adaptation += current.boost; if(adaptation>adaptTarget) adaptation=adaptTarget; meter.style.width = adaptation + '%'; percent.innerText = adaptation + '%'; log.innerText += `\n${new Date().toLocaleTimeString()}: ${document.getElementById('player').value||'Explorer'} applied ${current.title} (+${current.boost}%)`; document.getElementById('apply-btn').disabled = true; document.getElementById('open-btn').disabled = true; buildList(); if(adaptation>=adaptTarget){ finishPlant(); } }
function finishPlant(){ // flourish animation
  const cell = document.getElementById('cell-visual'); cell.innerHTML = ''; for(let i=0;i<30;i++){ const p=document.createElement('div'); p.style.width='10px'; p.style.height='10px'; p.style.position='absolute'; p.style.left=(30+Math.random()*500)+'px'; p.style.top=(30+Math.random()*100)+'px'; p.style.background = (Math.random()>0.5)?'#c6ffb3':'#bfffcf'; p.style.borderRadius='6px'; p.style.transition='transform 1000ms ease, opacity 1000ms'; cell.appendChild(p); setTimeout(()=>{ p.style.transform = `translateY(-80px) scale(0.1)`; p.style.opacity='0'; }, 50 + i*30); } log.innerText += `\n\n=== EVOLUTION COMPLETE ===\n${document.getElementById('player').value||'Explorer'} fully adapted the Venus Flytrap at ${new Date().toLocaleTimeString()}`; }

/* ---- helpers ---- */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function resetAll(){ location.reload(); }

buildList();
</script>
</body>
</html>
